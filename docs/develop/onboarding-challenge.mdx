import ConceptImage from '@site/src/components/conceptImage'

# Onboarding Challenge

Welcome aboard! üõ≥ You came here to become a true **TVM Developer** on the most advanced asynchronous blockchain in the world called The Open Network (TON).

Through this tutorial, you'll learn how to make blockchain transactions using JavaScript easily. You'll learn the same even without this tutorial, but here is the cool way.

_You'll mine an NFT rocket!!!_

As the first miners on TON, you will go through the Proof-of-Work smart contract and finally mine a secret reward for your TON wallet. Look at that:

<div style={{ textAlign: 'center', margin: '0 auto' }}>
  <video width={'300'} style={{ borderRadius: '10pt', margin: '15pt auto' }} muted={true} autoPlay={true} loop={true}>
    <source src="/docs/files/onboarding-nft.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
</div>

Our goal for today is to mine an NFT! This achievement will stay with you *forever*.

Finally, you can mine this NFT achievement even in mainnet. (_it costs only 0,05 TON!_)

:::caution tutorial in open beta
You are one of the first explorers here. If you found any mistake or feel stacked, please send feedback to [@SwiftAdviser](https://t.me/SwiftAdviser). I will fix it asap.
:::

## ‚õè Mining on TON

Today you will prove your talent using the most ancient and essential way in blockchains, starting from grandpa Bitcoin! _~Mining~_

The initial historical mining process on TON was finished a long time ago. After the TON Blockchain launch, POW Giver smart contracts were launched, and everybody can participate. Fortunately, those times are over, and the era of Staking has begun.

* [Read more about mining history on TON](https://ton.org/mining)


But right now, you will finish the old ritual of becoming a true **TVM Developer**. Let's leave the boring Toncoins for old ones. Let's mine an NFT today! Here is what you will make:

<div style={{ textAlign: 'center', margin: '0 auto' }}>
  <video style={{ borderRadius: '10pt', margin: '15pt auto', maxWidth: '90%' }} muted={true} autoPlay={true}
         loop={true}>
    <source src="/docs/files/onboarding.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
</div>

Amazed? It's possible to make miner in __2 hours__ from now, just stay in focus.

Let's go deeper into the Onboarding Challenge now.

## üì≤ Prepare a Wallet

As any miner years ago, you need a _non-custodial_ wallet with your address to receive and store your future reward! Moreover, you need a testnet mode enabled to collect some test Toncoins. You will use them to send a final minting transaction to the smart contract later.

So, prepare your wallet by these 2 steps:

1. Install a Tonkeeper app on your smart phone.
2. [Enable test mode in Tonkeeper](https://ton.org/docs/participate/wallets/apps#tonkeeper) to play with TON Testnet.

Easy! Let's go to development right now.

[//]:  # (## üìö Basic Concepts)

[//]:  # ()
[//]:  # (Before start, it would be good for you to understand some concepts. Otherwise, you would be scary of the things we will cover later. We won't go deep in theory, but some points are necessary to understand:)

##  ü¶Ñ Project setup

To make your life easier and omit routine low-level stuff, we will use a boilerplate. Please, use the [ton-onboarding-challenge](https://github.com/ton-community/ton-onboarding-challenge) template to create your project there:

<ConceptImage src="/img/tutorials/onboarding/1.png" />

After completing this step, you get a fully-fledged repository that can be used as your miner's core. Congratulations! ‚ú®

### Development environment

Before we'll cover environment setup, you should know: _it's possible to complete TON Onboarding Challenge completely in the cloud! It's free and quickly._

#### Cloud vs Local

* If you don't use Javascript in your everyday life, you don't want to install Javascript IDE and tools, or your computer is not a good choice for development, it would be faster to use a **cloud environment**. It's completely free and provided by GitHub.

* However, if you're familiar with NodeJS, and Git and know how to work with `npm`, it would be more comfortable for you to use a **local environment**.

#### Cloud codespace

Good, so you decided to use the cloud today! In 2022 it's easy to start any project in the cloud with one simple step on your GitHub repository:

<ConceptImage src="/img/tutorials/onboarding/2.png" />

After this, GitHub will create a special cloud workspace with VSCode Online IDE. You don't need to install git, nodejs, or other tools.

Just wait for _~30 seconds_ so that the terminal will install all dependencies.

#### Local environment

For local development you need 3 things:

- **Git**. Essential tool for every developer. Download it here.
- **NodeJS**. We will use Javascript with TypeScript mode as the most popular choice for DApp development. Download it here.
- **Javascript IDE**. Your normal choice for development. VSCode Online, for example.

To start development, please:

1. Clone your GitHub repository boilerplate
2. Open repository in your IDE

Great! After these steps you're ready to go deeper to the TON Blockchain secrets.

## üéØ Connect to TON

Okay, what you need to connect to the TON Blockchain?

* __Smart contract address__ as a point of destination. Our goal is to mine NFT from the _proof-of-work smart contract_, so we need an address to get current mining complexity.
* __API provider__ to make requests to the TON Blockchain. TON has multiple [API types](/develop/dapps/apis/) for different purposes. We will use testnet version of [toncenter.com](https://toncenter.com/) API.
* __JavaScript SDK__ to parse address and prepare it to make API request. Read more about [smart contract addresses](/learn/overviews/addresses) to understand why we should parse it. We will use [ton.js](https://github.com/ton-community/ton).

Let's go deeper to understand how to make your very first request to the TON Blockchain using toncenter API and `ton.js` and get data from the proof-of-work smart contract!

### Smart contract addresses

[Find the collection address on GetGems](#).

We need to add two addresses to the miner:

1. __Wallet address__ which will receive an NFT reward.
2. __Collection address__ smart contract to mine an NFT.

Open your `index.ts` file in your project and create main function with initial constants:

```ts title="ton-onboarding-challenge/index.ts"
import {Address} from "ton"

async function main () {

  const wallet = Address.parse('YOUR_WALLET_ADDRESS');
  const collection = Address.parse('COLLECTION_ADDRESS');

}

main()
```

#### Why do we need `async function main()` function?

Later, you will make some requests to the public API, so you need to wait for responses from API in your code with some `await` constructions. Async/await allows us save simplicity of code comparing to promises approach.

#### Why do we need to parse addresses?

In TON, addresses could have different forms and even different flags. Today we will use a _user-friendly form_, but if you are interested read more about [smart contract addresses](/learn/overviews/addresses).

`Address.parse()` from `ton.js` SDK allows you to create an address object to convert address from one form to another easily.

### Connect to API provider

We need to connect to the TonCenter API provider hosted on [toncenter.com](https://toncenter.com).

In `ton.js`, you can use _TonClient_ for that:

```ts title="ton-onboarding-challenge/index.ts"
import {Address, TonClient} from "ton"

  // ... previous code

  const client = new TonClient({
    endpoint: 'https://testnet.toncenter.com/api/v2/jsonRPC',
    apiKey: 'YOUR_API_KEY',
  })

```

If you try to make a request without an API key, you probably will have problems.

API key allows you to make 10 requests per second. It's not suitable for production, but in our case 10 requests is more than enough for the Onboarding Challenge:

* [Get an API key](/develop/dapps/apis/toncenter#get-api-key) for testnet on the API page

:::info what to do in production?
It's better to use RPC node provider or run your own ton-http-api instance for that. Read more on the [TonCenter API page](/develop/dapps/apis/toncenter).
:::

### Get Mining Data from TON

Finally, we can try to get some data from the TON Blockchain!

Regarding the initial [README file](https://github.com/ton-community/ton-onboarding-challenge#mining-process-advanced) of the ton-onboarding-challenge we can see that the latest mining data you can get by running `get_mining_data` method.

As a result we should receive an array with these fields:

```bash
(
	int pow_complexity,
	int last_success,
	int seed,
	int target_delta,
	int min_cpl,
	int max_cpl
)
```

#### How to run a method of any smart contract in TON?

With `ton.js` you can run `callGetMethod(SMART_CONTRACT_ADDRESS, METHOD)` function.
Try to run this code and read the console output:

```ts title="ton-onboarding-challenge/index.ts"
  // ... previous code

  const miningData = await client.callGetMethod(collection, 'get_mining_data')

  console.log(miningData)
```

To run the script you need to write in terminal (in project directory!):

```bash
npm run start
```

Good! If all the things are good, you successfully connected to the API and received some data to the console. Probably, you won't understand anything from the raw console output:

```bash
{
  gas_used: 2374,
  stack: [
    [
      'num',
      '0x2880000000000000000000000000000000000000000000000000000000000'
    ],
    [ 'num', '0x63984815' ],
    [ 'num', '0x357401cf9b4f2386950faefd6b616264' ],
    [ 'num', '0x1e' ],
    [ 'num', '0xab' ],
    [ 'num', '0xfc' ]
  ]
}
```

Yes, we see here how many gas was used to run the method and some _num_ values in `hex` format, but even this information is useless for us right now.

We need to convert hex output to something _useful_.

:::note how gas works in ton?
__Warning__: this information is pretty low level and __not necessary for this tutorial__. Read about it only if you are excited to go down to the low level technical aspects of TON.
1. Understand the concepts of TVM and _how transactions work_ in [TVM overview](/learn/tvm-instructions/tvm-overview).
2. After that go deeper in [transaction fees](/develop/smart-contracts/fees) concepts to see _what the gas is_.
3. Finally, see [the exact values in gas](/learn/tvm-instructions/instructions#11-gas-prices) for TVM instructions.

Again, it's not necessary, you can read it _later_. Let's return to the tutorial!
:::

#### Make Mining Data user-friendly

Ok, then we must convert `hex` numbers to something we can understand and use.

But we have a problem here. As you see with your output, even hex numbers are pretty big. We can't just move them to the variable and use it, because of [JavaScript limitations](https://stackoverflow.com/questions/307179/what-is-javascripts-highest-integer-value-that-a-number-can-go-to-without-losin#:~:text=Note%20that%20the%20bitwise%20operators,31%2D1%2C%20or%202%2C147%2C483%2C647.).

That's why we need `bn.js`. It's a library to work with Big Numbers, that are bigger than maximum JavaScript integer values. Use this example to see the _Mining Data_:

```ts title="ton-onboarding-challenge/index.ts"
import {BN} from 'bn.js'

  // ... previous code

  const parseStackNum = (sn: any) => new BN(sn[1].substring(2), 'hex');

  const complexity = parseStackNum(miningData.stack[0]);
  const last_success = parseStackNum(miningData.stack[1]);
  const seed = parseStackNum(miningData.stack[2]);
  const target_delta = parseStackNum(miningData.stack[3]);
  const min_cpl = parseStackNum(miningData.stack[4]);
  const max_cpl = parseStackNum(miningData.stack[5]);

  console.log('complexity', complexity);
  console.log('last_success', last_success.toString());
  console.log('seed', seed);
  console.log('target_delta', target_delta.toString());
  console.log('min_cpl', min_cpl.toString());
  console.log('max_cpl', max_cpl.toString());
```

As you see, _miningData_ is a stack array with hex numbers. To get the values, we added `parseStackNum` function that creates a _BN_ object from hex number.

After that we try to print values in console. Some values are printed as BN, as it will provide more user-friendly way for us. Try to run the script again with command:

```bash
npm run start
```

#### What do you see in console?

Here is an example output:

```bash
complexity <BN: 2880000000000000000000000000000000000000000000000000000000000>
last_success 1670924309
seed <BN: 357401cf9b4f2386950faefd6b616264>
target_delta 30
min_cpl 171
max_cpl 252
```

Let's cover the Mining Data deeper to understand the concepts of mining:

* `complexity` is the most important number for miner. It's a Proof-of-Work complexity for the values. You're successful, _if the final hash is less than complexity_.
* `last_success` is a unixtime of the last mining transaction. Every time last_success changes you need to run miner again, because seed changes too.
* `seed` is a unique value generated by smart contract to calculate a hash. If you're interested how seed changes search in the project files with `ctx_seed` keyword.
* `target_delta`, `min_cpl` and `max_cpl` won't be used in our tutorial. But you always can read more how they used in smart contract to calculate proof-of-work complexity in source files of collection in your project.

## ‚õè Prepare an NFT Miner

### step 6: define mineParameters

```ts title="ton-onboarding-challenge/index.ts"
  import {MineMessageParams, Queries} from "./src/giver/NftGiver.data";

// ...

  const mineParams : MineMessageParams = {
    expire: unixNow() + 30,
    mintTo: wallet,
    data1: new BN(0),
    seed
  };

```

### step 7: write miner

```ts title="ton-onboarding-challenge/index.ts"


  let msg = Queries.mine(mineParams);
  let progress = 0;

  while (new BN(msg.hash(), 'be').gte(complexity)) {
    progress += 1
    console.clear()
    console.log(`Mining started: please, wait for 30-60 seconds to mine your NFT!`)
    console.log(' ')
    console.log(`‚õè Mined ${progress} hashes! Last: `, new BN(msg.hash(), 'be').toString())

    mineParams.expire = unixNow() + 30
    mineParams.data1.iaddn(1)
    msg = Queries.mine(mineParams)
  }

  console.log(' ')
  console.log('üíé Mission completed: msg_hash less than pow_complexity found!');
  console.log(' ')
  console.log('msg_hash: ', new BN(msg.hash(), 'be').toString())
  console.log('pow_complexity: ', complexity.toString())
  console.log('msg_hash < pow_complexity: ', new BN(msg.hash(), 'be').lte(complexity))

```

## üé® Make a Mining Transaction

### Step 8: prepare a payment link

```ts title="ton-onboarding-challenge/index.ts"


  console.log(' ');
  console.log("üí£ WARNING! As soon as you find the hash, you should quickly make a transaction.");
  console.log("If someone else makes a transaction, the seed changes, and you have to find a hash again!");
  console.log(' ');

  const collectionAddr = collection.toFriendly({
    urlSafe: true,
    bounceable: true,
  })
  const amountToSend = toNano('0.05').toString()
  const preparedBodyCell = msg.toBoc().toString('base64url')

  const tonDeepLink = (address: string, amount: string, body: string) => {
    return `ton://transfer/${address}?amount=${amount}&bin=${body}`;
  };

  const link = tonDeepLink(collectionAddr, amountToSend, preparedBodyCell);

  // console.log('üöÄ Link to receive mine NFT (use Tonhub or Tonkeeper):')
  // console.log(link);

```

### Step 9: link for smartphone

```ts title="ton-onboarding-challenge/index.ts"


const qrcode = require('qrcode-terminal');

  qrcode.generate(link, {small: true}, function (qrcode : any) {
    console.log('üöÄ Link to mine your NFT (use Tonkeeper in testnet mode):')
    console.log(qrcode);
    console.log('* If QR is still too big, please run script from the terminal. (or make the font smaller)')
  });

```


### Step 10: mine in mainnet