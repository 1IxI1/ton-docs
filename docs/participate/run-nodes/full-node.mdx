import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Running a Full Node

To install and manage your own node, use the **MyTonCtrl** open source tool developed by TON Foundation. The majority of TON Nodes are reliable and tested by **mytonctrl**.

[MyTonCtrl](https://github.com/ton-blockchain/mytonctrl) is a console application that serves as a convenient wrapper for fift, lite-client, and validator-engine-console. It has been specifically developed to streamline wallet, domain, and validator management tasks on the Linux operating system.

We're collecting feedback about the installation process. If you have any questions or suggestions, please, [contact us](https://t.me/SwiftAdviser).

## Prerequisites

We highly recommend install mytonctrl using the supported operating systems:
* Ubuntu 20.04
* Ubuntu 22.04
* Debian 11

Please, use a **non-root user** with **sudo** privileges to install and run mytonctrl.

## Hardware requirements

This requirements are for a **full node with a validator**. If you want to run a full node without a validator (e.g. liteserver), you can use a less powerful machine.

- at least 8 cores CPU
- at least 64 GB RAM
- at least 512 GB NVMe SSD (25k+ IOPS)
- 1 Gbit/s network connectivity
- public IP address (_fixed IP address_)

You need a machine with a **fixed IP address** and a **high-bandwidth network connection** to run a TON Blockchain Full Node. Typically you'll need a sufficiently powerful server in a data center with good network connectivity, using at least a 1 Gbit/s connection to reliably accommodate peak loads (the average load is expected to be approximately 100 Mbit/s).

### Recommended Providers

The following providers are recommended by the TON Foundation for running a Validator:

#### AWS

- **Instance Type:** `m5.4xlarge`
- **CPU:** 16 vCPUs
- **RAM:** 64 GB
- **Storage:**  Provisioned IOPS 512 GB SSD volume. (io1)
- **Network:** Up to 10 Gbps
- **Public IP:** Associate an Elastic IP for a fixed IP address.

#### GCP (Google Cloud Platform)

- **Machine Type:** `n2-highmem-8` or `n2d-highmem-8`
- **CPU:** 8 vCPUs
- **RAM:** 64 GB
- **Storage:** Attach a 512 GB NVMe SSD persistent disk.
- **Network:** 16 Gbps
- **Public IP:** Reserve a static external IP address.

#### Alibaba Cloud

- **Instance Type:** `ecs.g6.4xlarge` or `ecs.c6.4xlarge`
- **CPU:** 16 vCPUs
- **RAM:** 64 GB
- **Storage:** Provision a 512 GB NVMe SSD disk.
- **Network:** Up to 10 Gbps
- **Public IP:** Bind an Elastic IP for a fixed IP address.

#### Tencent Cloud

- **Instance Type:** `M5.2XLARGE`
- **CPU:** 8 vCPUs
- **RAM:** 64 GB
- **Storage:** Provision a 512 GB NVMe SSD cloud disk.
- **Network:** Up to 10 Gbps
- **Public IP:** Associate an Elastic IP for a fixed IP address.

#### Vultr

- **Instance Type:** `bare metal Intel E-2388G`
- **CPU:** 8 Cores / 16 Threads
- **RAM:** 128 GB
- **Storage:** 1.92TB NVMe SSD
- **Network:** 10 Gbps
- **Public IP:** Fixed IP address included with instance.

#### DigitalOcean

- **Instance Type:** `general purpose premium Intel`
- **CPU:** 16 vCPUs
- **RAM:** 64 GB
- **Storage:** 480GB (Chose 2xSSD)
- **Network:** 10 Gbps
- **Public IP:** Fixed IP address included with instance.

#### Latitude

- **Instance Type:** `c3.medium.x86`
- **CPU:** 16 Cores / 32 Threads
- **RAM:** 128 GB
- **Storage:** 1.9TB
- **Network:** 10 Gbps
- **Public IP:** Fixed IP address included with instance.

:::info
**Note:** Prices, configurations, and availability may vary. Always check the respective cloud provider's official documentation and pricing pages before making a decision.
:::

## How to run a Node? (video)

[//]: # (<ReactPlayer controls={true} style={{borderRadius:'10pt', margin:'15pt auto', maxWidth: '100%'}} url='/docs/files/setup_validator.mp4' />)

Please, check this video step-by-step tutorial to start promtly:

<video style={{borderRadius:'10pt', margin:'auto', width: '100%', maxWidth: '100%'}} controls={true}>
    <source src="/files/setup_validator.mp4" type="video/mp4" />
</video>

## Step-by-step instructions

### Prerequisites

1. Login to your server as a **non-root** user with **sudo** privileges.

2. If you don't have a non-root user, create it:

```bash
sudo adduser <username>
```

3. Add your user to the sudo group:

```bash
sudo usermod -aG sudo <username>
```

4. Switch to your non-root user:

```bash
su - <username>
```


### Install the mytonctrl

Download and run the installation script from the **non-root** user account with **sudo** privileges. Choose your Linux distributive:



<Tabs groupId="operating-systems">
  <TabItem value="ubuntu" label="Ubuntu">

  ```bash
  wget https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/scripts/install.sh
  sudo bash install.sh -m full -d
  ```

  </TabItem>
  <TabItem value={'debian'} label={'Debian'}>

  ```bash
  wget https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/scripts/install.sh
  su root -c 'bash install.sh -m full -d'
  ```

  </TabItem>
</Tabs>

* `-m full` - Full node installation mode.
* `-d` - **mytonctrl** will download a [dump](https://dump.ton.org/) of the latest blockchain state.
This will reduce synchronization time by several times.
* `-c <path>` - If you want to use not public liteservers for synchronization. _(not required)_


### Run the mytonctrl

1. Run **mytonctrl** console from the local user account used for installation in step 1:

 ```sh
 mytonctrl
  ```

2. Check the mytonctrl statuses using the `status` command:

  ```sh
  status
  ```


The following statuses should be displayed:

* **mytoncore status**: Should be in green.
* **Local validator status**: Should also be in green.
* **Local validator out of sync**: Initially, a large number is displayed. As soon as the newly created validator connects with other validators, the number will be around 250k. As synchronization progresses, this number decreases. When it falls below 20, the validator is synchronized.

Example of the **status** command output:

![status](https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/screens/mytonctrl-status.png)

Wait until `Local validator out of sync` become less than 20 seconds.

## Become a Validator


### View the List of Wallets

Check out the list of available wallets in the **mytonctrl** console using the `wl` command:

```sh
wl
```

During the installation of **mytonctrl**, the **validator_wallet_001** wallet is created:

![wallet list](https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/screens/manual-ubuntu_mytonctrl-wl_ru.png)


### Activate the Wallets

Send the Required Number of Coins to the Wallet and Activate It

To determine the minimum amount of coins required to participate in one election round, head to **tonmon.xyz** > **Participant stakes**.

* Use the `vas` command to display the history of transfers:

  ```sh
  vas
  ```

* Activate the wallet using the `aw` command

  ```sh
  aw
  ```

![account history](https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/screens/manual-ubuntu_mytonctrl-vas-aw_ru.png)

### Your Validator is Now Ready

**mytoncore** will automatically join the elections. It divides the wallet balance into two parts and uses them as a stake to participate in the elections. You can also manually set the stake size:

```sh
set stake 50000
```

`set stake 50000` â€” this sets the stake size to 50k coins. If the bet is accepted and our node becomes a validator, the bet can only be withdrawn in the second election (according to the rules of the electorate).

![setting stake](https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/screens/manual-ubuntu_mytonctrl-set_ru.png)


## Enable Liteserver mode

When an endpoint is activated in a full node, the node assumes the role of a **Liteserver**. This node type can field and respond to requests from Lite Clients, allowing for seamless interaction with the TON Blockchain.

### Hardware requirements

Compared to a validator, a liteserver mode requires less resources. However, it is still recommended to use a powerful machine to run a liteserver.

- at least 8 cores CPU
- at least 8 GB RAM
- at least 512 GB NVMe SSD
- 1 Gbit/s network connectivity
- public IP address (_fixed IP address_)

### Installation of liteserver

1. Complete the previous steps to install [mytonctrl](/participate/run-nodes/full-node#step-by-step-instructions).

2. Create config file

```bash
MyTonCtrl> installer
MyTonInstaller> clcf

Local config file created: /usr/bin/ton/local.config.json
```

3. This file will help you to connect to your liteserver. Copy the config file located on the specified path to your home to save it.

```bash
cp /usr/bin/ton/local.config.json ~/config.json
```

4. Create an empty `config.json` file on your local machine.

5. Copy the content from the console to your local machine `config.json` file.

```bash
cat ~/config.json
```

### Check the firewall settings

First, verify the Liteserver port specified in your `config.json` file. This port changes with each new installation of `mytonctrl`. It is located in the `port` field:

```bash
cat ~/config.json | grep port
```

If you are using a cloud provider, you need to open this port in the firewall settings. For example, if you are using AWS, you need to open the port in the [security group](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security-groups.html).

Below is an example of opening a port in the bare metal server firewall.

#### Opening a port in the firewall

We will use the `ufw` utility ([cheatsheet](https://www.cyberciti.biz/faq/ufw-allow-incoming-ssh-connections-from-a-specific-ip-address-subnet-on-ubuntu-debian/)). You can use the one you prefer.

1. Install `ufw` if it is not installed:

```bash
sudo apt update
sudo apt install ufw
```

2. Allow ssh connections:

```bash
sudo ufw allow ssh
```

3. Allow the port specified in the `config.json` file:

```bash
sudo ufw allow <port>
```

4. Check the firewall status. After running this command, you can verify that the rules have been added successfully by checking the UFW status:

```bash
sudo ufw status
```

5. Enable the firewall:

```bash
sudo ufw enable
```

This way, you can open the port in the firewall settings of your server.

### Interaction with Liteserver

0. Create an empty project on your machine and paste `config.js` in the project directory.

1. Install libraries.

<Tabs groupId="code-examples">
  <TabItem value="js" label="JavaScript">

  ```bash
  npm i --save ton-core ton-lite-client
  ```

  </TabItem>
  <TabItem value="python" label="Python">

  ```bash
  pip install pytonlib
  ```

  </TabItem>
  <TabItem value="go" label="Golang">

  ```bash
  go get github.com/xssnick/tonutils-go
  go get github.com/xssnick/tonutils-go/liteclient
  go get github.com/xssnick/tonutils-go/ton
  ```
  </TabItem>
</Tabs>

2. Initialize client and request masterchain info to make sure liteserver is running.

<Tabs groupId="code-examples">
  <TabItem value="js" label="JavaScript">

  Change project type to `module` in your `package.json` file:

  ```json
  {
    "type": "module"
  }
  ```

  Create `index.js` file with the following content:
  ```js
  import { LiteSingleEngine } from 'ton-lite-client/dist/engines/single.js'
  import { LiteRoundRobinEngine } from 'ton-lite-client/dist/engines/roundRobin.js'
  import { LiteClient } from 'ton-lite-client/dist/client.js'
  import config from './config.json' assert {type: 'json'};


  function intToIP(int ) {
  var part1 = int & 255;
  var part2 = ((int >> 8) & 255);
  var part3 = ((int >> 16) & 255);
  var part4 = ((int >> 24) & 255);

  return part4 + "." + part3 + "." + part2 + "." + part1;
}

  let server = config.liteservers[0];

  async function main() {
  const engines = [];
  engines.push(new LiteSingleEngine({
  host: `tcp://${intToIP(server.ip)}:${server.port}`,
  publicKey: Buffer.from(server.id.key, 'base64'),
}));
  const engine = new LiteRoundRobinEngine(engines);
  const client = new LiteClient({ engine });
  const master = await client.getMasterchainInfo()
  console.log('master', master)

}
  main()

  ```

  </TabItem>
  <TabItem value="python" label="Python">

    ```python
    import asyncio
    from pytonlib import TonlibClient
    from pathlib import Path
    import json


    async def get_client() -> TonlibClient:
    with open('config.json', 'r') as f:
    config = json.loads(f.read())

    keystore_dir = '/tmp/ton_keystore'
    Path(keystore_dir).mkdir(parents=True, exist_ok=True)

    client = TonlibClient(ls_index=0, config=config, keystore=keystore_dir, tonlib_timeout=10)
    await client.init()

    return client


    async def test_client():
    client = await get_client()

    print(await client.get_masterchain_info())

    await client.close()


    if __name__ == '__main__':
    asyncio.run(test_client())
    ```

  </TabItem>
  <TabItem value="go" label="Golang">

  ```go
  package main

  import (
  "context"
  "encoding/json"
  "io/ioutil"
  "log"
  "github.com/xssnick/tonutils-go/liteclient"
  "github.com/xssnick/tonutils-go/ton"
  )

  func main() {
  client := liteclient.NewConnectionPool()

  content, err := ioutil.ReadFile("./config.json")
  if err != nil {
  log.Fatal("Error when opening file: ", err)
}

  config := liteclient.GlobalConfig{}
  err = json.Unmarshal(content, &config)
  if err != nil {
  log.Fatal("Error during Unmarshal(): ", err)
}

  err = client.AddConnectionsFromConfig(context.Background(), &config)
  if err != nil {
  log.Fatalln("connection err: ", err.Error())
  return
}

  // initialize ton api lite connection wrapper
  api := ton.NewAPIClient(client)

  master, err := api.GetMasterchainInfo(context.Background())
  if err != nil {
  log.Fatalln("get masterchain info err: ", err.Error())
  return
}
  log.Println(master)
}

  ```
  </TabItem>
</Tabs>

3. Now you can interact with your own liteserver.

### See also

* [[YouTube]Tutorial how to launch liteserver](https://youtu.be/p5zPMkSZzPc)


## Tips & Tricks

- You can use `help` to get a list of available commands:

![help command](https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/screens/manual-ubuntu_mytonctrl-help_ru.png)

- To check **mytoncrl** logs, open `~/.local/share/mytoncore/mytoncore.log` for a local user or `/usr/local/bin/mytoncore/mytoncore.log` for Root.

![logs](https://raw.githubusercontent.com/ton-blockchain/mytonctrl/master/screens/manual-ubuntu_mytoncore-log.png)


## Troubleshooting

This section contains answers to the most frequently asked questions about running a nodes.

### What does Error 651 mean?

`[Error : 651 : no nodes]` indicates that your node is unable to locate another node within the TON Blockchain.

Sometimes, this process can take up to 24 hours. However, if you've been receiving this error for several days, that means that your node cannot synchronize via current network connection.

:::tip Solution
You need to check the firewall settings, including any NAT settings if they exist.

It should allow incoming connections on one specific port and outgoing connections from any port.
:::

### Validator console is not settings

If you see this error this means that you run `mytonctrl` not from the user you've installed it.

:::tip Solution
Run `mytonctrl` from the user you've installed it (non-root sudo user).

```bash
sudo mytonctrl
```
:::

### What does block is not applied mean?

Sometimes we get `block is not applied` or `block is not ready` for various request - is this normal?

This is normal, typically this means you tried to retrieve block, wich does not reach the node you asked.

:::tip Solution
Retry request up to three times.
:::

### Out of Sync Issue with -d Flag

If you encounter an issue where the `out of sync` equals the timestamp after downloading `mytonctrl` with the `-d` flag, it's possible that the dump wasn't installed correctly (or it's already out of date).

:::tip Solution
The recommended solution is to reinstall `mytonctrl` again with the new dump.
:::

If it takes a very long time to sync, there may have been issues with the dump. Please, [contact us](https://t.me/SwiftAdviser) for assistance.